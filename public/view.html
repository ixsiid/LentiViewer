<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <link rel="manifest" href="/manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>View</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            border: none;
        }

        html,
        body,
        #content {
            width: 100%;
            height: 100%;
        }

        #navi {
            position: fixed;
            bottom: 0.3em;
            left: 0;
            width: 100%;
            text-align: right;
            vertical-align: middle;
            color: white;
            font-weight: bold;
        }

    </style>

    <script src="script/switch.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/105/three.min.js"></script>
    <script type="module">
        import { quat, mat4, vec3 } from './util/gl-matrix/src/index.js';
        import PlaneFactory from './lenti_mask/renderer/plane.js';

        import Lenti from './lenti_mask/index.js';

        const game = {};
        const items = [];

        function update() {
            items.map(x => x.rotation.y += 0.01);

            game.renderer.clear(true, true, false);

            game.lenti.render(game.scene);

            requestAnimationFrame(update);
        }


        window.addEventListener('load', async () => {
            const content = document.querySelector('#content');
            const { width, height } = (() => {
                const bounds = content.getClientRects()[0];
                return { width: bounds.width, height: bounds.height };
            })();

            game.renderer = new THREE.WebGLRenderer({
                canvas: content,
                preserveDrawingBuffer: true,
            });
            game.renderer.autoClear = false;
            game.renderer.setPixelRatio(window.devicePixelRatio);
            game.renderer.setSize(width, height);

            const lens = {
                SlantAngleDegrees: 76.95,
                ViewCount: 45,
                DPL: 7.59375 };
            const camera = {
                Distance: 1000,
                AngleOfViewDegrees: 45,   // １つのカメラの画角
                Aspect: width / height,
                ViewingAngleDegrees: 60 } // 観察者の視野角

            game.lenti = new Lenti(game.renderer, lens, camera);
            
            game.scene = new THREE.Scene();

            const geometry = new THREE.BoxGeometry(200, 200, 200);
            const material = new THREE.MeshNormalMaterial();
            const box = new THREE.Mesh(geometry, material);
            box.rotation.x += 0.5;
            game.scene.add(box);

            items.push(box);

            update();
        }, false);
    </script>
</head>

<body>
    <p id="navi"><a href="app.html">App</a></p>
    <canvas id="content"></canvas>
</body>

</html>
